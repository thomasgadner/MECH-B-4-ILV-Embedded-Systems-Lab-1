---

# **Laborrichtlinie: Hauptschleife mit Interrupt-Routine**

---

## **Übersicht**

In diesem Labor lernen wir, wie man eine Hauptschleife implementiert, um Töne zu erzeugen, und wie man eine Interrupt‑Routine verwendet, um die abgespielte Melodie zu ändern. Die Hauptaufgabe besteht darin, die Super‑Mario‑Melodie abzuspielen und mithilfe einer Taste auf die Underground‑Mario‑Melodie umzuschalten oder eine zusätzliche Verzögerung in die abgespielte Melodie einzufügen. Die Verzögerung sollte mit einem Oszilloskop visualisiert werden.

---

## **Ziele**
1. Verstehen des Konzepts einer Hauptschleife.
2. Erlernen der Tonerzeugung mithilfe von GPIO-Toggling.
3. Implementierung einer Interrupt-Service-Routine (ISR), die durch einen Taster ausgelöst wird.
4. Verstehen des Konzepts einer ISRs und der einfluss seines Dauer in eingebetteten Systemen.
5. Visualisierung der erzeugten Signale mit einem Oszilloskop.

---


## **Vorbereitung vor dem Labor**
1. **Implementierung des Hauptschleife und die Funktionen die notwendig sind eine Melodie (eine melody wird mit Tonen und Länge für jede Ton definiert) zu spielen**:
Gegeben:
   - LUT mit alle die Tönen 
   - Mario und Mario-Underworld Melodien LUT (Tönen und Tempo)  
  
Abgabe:
    - Hauptschleife für spielen des Mario-Melody.
    - Implementierung der Funktion `playMelody(uint16_t tone, uint8_t tempo)` die als input die Tone und Tempo für jede Tone nimmt und die Melody auf dem Buzzer spielt.
    - Implementierung der Funktion `delayMicroseconds(uint32_t microSeconds)` die basierend auf `sysclock` eine Verzögerung um die gegebenen Mikrosekunden erzeugt.
---

## **Laboranleitung**

### **Schritt 1: Aufbau der Hardware**
1. Verbinden Sie den Piezo-Buzzer oder Lautsprecher mit einem GPIO-Pin des Nucleo-F091 Boards.
2. Konfigurieren Sie die Tasten als Eingänge mit Pull-Up-Widerstand.

---

### **Schritt 2: Implementierung des ISR Codes**

1. Konfigurieren Sie die GPIO-Pins der Tasten als externe Interrupts.
   

2. Implementieren Sie die ISRs:
    - ISR1/Taste 1: Spielt die Underground-Mario-Melodie ab.
    - ISR2/Taste 2: Fügt in der Super-Mario-Melodie eine Verzögerung von einer Sekunde ein.

---

### **Schritt 3: Messung** (Labor)
1. Ausführungsdauer von ISR2.

---

## **Abgabe**
1. Spielen Sie der Super-Mario-Melodie.
2. Verwenden Sie Taste 1, um die Melodie zu wechseln.
3. Verwenden Sie Taste 2, um eine Verzögerung einzufügen.
4. Zeigen Sie die Dauer von ISR2 an. Welchen Einfluss hat diese Dauer auf die Hauptschleife?
5. Finden Sie eine Dauer für ISR2, die die Hauptschleife nicht beeinflusst, und messen Sie diese neue Dauer.
6. Leiten Sie wichtige Erkenntnisse aus den Ergebnissen ab.





